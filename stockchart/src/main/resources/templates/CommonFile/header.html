<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:attr="data-theme=${theme != null ? theme : 'light'}">
<head>
<style>
  /* 검색창 스타일 */
  #tickerInput {
    width: 300px;
    height: 300px; 
    padding: 8px;
    font-size: 16px;
  }

  /* 자동완성 목록 스타일 */
  #autocompleteList {
    border: 1px solid #ccc;
    border-top: none;
    max-height: 150px;
    overflow-y: auto;
    position: absolute;
    width: 300px;
    background-color: #fff;
    z-index: 1000;
  }

  /* 목록 아이템 스타일 */
  .autocomplete-item {
    padding: 8px;
    cursor: pointer;
  }

  .autocomplete-item:hover {
    background-color: #f0f0f0;
  }
  
  :root {
  --bg-color: #ffffff;
  --text-color: #000000;
}

[data-theme='dark'] {
  --bg-color: #121212;
  --text-color: #e0e0e0;
}

body {
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background-color 0.3s, color 0.3s;
}

searchResults {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    width: 200px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
}

</style>

	<link href="/css/header.css" rel="stylesheet" type="text/css">
</head>
<body>
<header class="header"style="width:2200px; height:130px;">
    <div class="container">
    
        <div class="row header-top"> 
         <div class="col logo">
 		<a href="/api/stock-data/main">
        <img src="/images/logo2.png" alt="Logo" class="logo-img" width="150" height="auto"/>
		</a>
</div>
              
    <div class="col search-bar" style="display: flex; align-items: center;">
    <!-- ✅ action, method 제거 -->
    <form id="stockSearchForm" style="display: flex; align-items: center; gap: 8px; width: 100%;">
        <input type="text" id="searchBox" placeholder="종목 검색..." autocomplete="off"
               style="flex: 1; padding: 6px;">
        <button type="submit" style="padding: 6px 12px; white-space: nowrap;">Search</button>
    </form>
    <div id="searchResults" class="dropdown" 
         style="position:absolute; background:white; border:1px solid #ccc; width:200px; display:none;"></div>
</div>
    
                <div class="col" style="display:flex;justify-content: space-around">
   <button id="darkModeButton">다크 모드 on off</button>
 

  
</div>
    
            <div class="col login">
            <form id="loginbutton" action="/api/stock-data/login" method="get">
  	  <button type="submit">로그인 및 회원가입</button>
  	  </form>
	</div>
        </div>
        
        <nav class="menu" style="display: flex;margin-left:150px;">
        
            <ul>
                <li><a href="/api/stock-data/enquiry">이론페이지</a></li>
                <li><a href="/api/stock-data/sector">히트맵</a></li>
                <li><a href="/api/stock-data/explain">문의하기</a></li>
                <li><a href="/api/stock-data/recommend">추천페이지</a></li>
               
            </ul>
            
        </nav>
    </div>
</header>

<script th:inline="javascript">
const searchBox = document.getElementById("searchBox");
const searchResults = document.getElementById("searchResults");
const form = document.getElementById("stockSearchForm");

// 🔍 입력 이벤트 - 자동완성
searchBox.addEventListener("input", async (e) => {
    const query = e.target.value.trim();
    if (!query) {
        searchResults.innerHTML = "";
        searchResults.style.display = "none";
        return;
    }

    const res = await fetch(`/api/search/window?q=${encodeURIComponent(query)}`);
    const data = await res.json();

    let html = "";

    if (data.favorites.length > 0) {
        html += "<strong>⭐ 즐겨찾기</strong><ul>";
        data.favorites.forEach(t => html += `<li onclick="selectSuggestion('${t}')">${t}</li>`);
        html += "</ul>";
    }

    if (data.recent.length > 0) {
        html += "<strong>🕒 최근 조회</strong><ul>";
        data.recent.forEach(t => html += `<li onclick="selectSuggestion('${t}')">${t}</li>`);
        html += "</ul>";
    }

    if (data.results.length > 0) {
        html += "<strong>🔍 검색 결과</strong><ul>";
        data.results.forEach(t => {
            html += `<li onclick="selectSuggestion('${t.ticker}')">
                        <a href="/stocks/${t.ticker}">
                           ${t.ticker} - ${t.companyName}
                        </a>
                     </li>`;
        });
        html += "</ul>";
        searchResults.style.display = "block";
    } else {
        searchResults.style.display = "none";
    }

    searchResults.innerHTML = html;
});

// ✅ 자동완성 항목 선택 처리
function selectSuggestion(value) {
    searchBox.value = value;
    searchResults.innerHTML = "";
    searchResults.style.display = "none";
}

form.addEventListener("submit", function(e) {
    e.preventDefault(); // 기본 submit 막기
    const ticker = searchBox.value.trim();
    if (ticker) {
        window.location.href = "/stocks/" + encodeURIComponent(ticker);
    }
});


</script>
	
</script>

<!-- <script th:src="@{/js/theme-toggle.js}">

const toggleButton = document.getElementById('theme-toggle');
const html = document.documentElement;

toggleButton.addEventListener('click', () => {
  const currentTheme = html.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  html.setAttribute('data-theme', newTheme);
  toggleButton.textContent = newTheme === 'light' ? '🌙 다크모드' : '☀️ 라이트모드';
  localStorage.setItem('theme', newTheme);
});

</script> -->
</body>
</html>
